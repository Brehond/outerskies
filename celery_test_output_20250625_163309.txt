2025-06-25 16:33:09,838 - __main__ - INFO - === COMPREHENSIVE CELERY TESTING ===
2025-06-25 16:33:09,839 - __main__ - INFO - Test output will be saved to: celery_test_output_20250625_163309.txt
2025-06-25 16:33:09,839 - __main__ - INFO - === TESTING CELERY AVAILABILITY ===
2025-06-25 16:33:15,934 - chart.celery_utils - WARNING - Celery broker not available: [WinError 10061] No connection could be made because the target machine actively refused it
2025-06-25 16:33:15,937 - __main__ - INFO - Celery available: False
2025-06-25 16:33:15,938 - __main__ - INFO - === TESTING SIMPLE TASK ===
2025-06-25 16:33:15,940 - __main__ - INFO - Test parameters: {'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus'}
2025-06-25 16:33:15,942 - __main__ - INFO - Calling create_task_with_fallback...
2025-06-25 16:33:15,944 - chart.celery_utils - INFO - === create_task_with_fallback START for ephemeris_test ===
2025-06-25 16:33:15,961 - chart.celery_utils - INFO - task_func: <@task: chart.tasks.calculate_ephemeris_task of default at 0x1c3370352d0>
2025-06-25 16:33:15,962 - chart.celery_utils - INFO - args: [{'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus'}]
2025-06-25 16:33:15,963 - chart.celery_utils - INFO - kwargs: None
2025-06-25 16:33:15,964 - chart.celery_utils - INFO - user: None
2025-06-25 16:33:15,965 - chart.celery_utils - INFO - parameters: {'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus'}
2025-06-25 16:33:15,966 - chart.celery_utils - INFO - Generated task_id: 437f49f8-1008-4939-802a-34537b6c75ad
2025-06-25 16:33:15,967 - chart.celery_utils - INFO - Checking if Celery is available for ephemeris_test...
2025-06-25 16:33:22,071 - chart.celery_utils - WARNING - Celery broker not available: [WinError 10061] No connection could be made because the target machine actively refused it
2025-06-25 16:33:22,072 - chart.celery_utils - WARNING - Celery is not available for ephemeris_test, using fallback
2025-06-25 16:33:22,073 - chart.celery_utils - INFO - Executing ephemeris_test task synchronously as fallback: 437f49f8-1008-4939-802a-34537b6c75ad
2025-06-25 16:33:22,074 - chart.celery_utils - INFO - Calling task_func.apply with args=[{'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus'}], kwargs={}
2025-06-25 16:33:22,083 - chart.tasks - INFO - Starting ephemeris calculation task 1ee85efb-6dc7-45f1-a525-249479102e45
2025-06-25 16:33:22,135 - chart.tasks - INFO - Completed ephemeris calculation task 1ee85efb-6dc7-45f1-a525-249479102e45
2025-06-25 16:33:22,136 - celery.app.trace - INFO - Task chart.tasks.calculate_ephemeris_task[1ee85efb-6dc7-45f1-a525-249479102e45] succeeded in 0.06300000000010186s: {'success': True, 'julian_day': 2447893.1666666665, 'positions': {'Sun': {'absolute_degree': 280.9841671564369, 'sign': 'Capricorn', 'degree': 10.98416715643691, 'retrograde': False, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Moon': {'absolute_degree': 335.51547225365795, 'sign': 'Pisces', 'degree': 5.515472253657947, 'retrograde': False, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Mercury': {'absolute_degree': 295.6209564847932, 'sign': 'Capricorn', 'degree': 25.620956484793226, 'retrograde': True, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Venus': {'absolute_degree': 306.19953435684306, 'sign': 'Aquarius', 'degree': 6.19953435684306, 'retrograde': True, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Mars': {'absolute_degree': 250.1173870808668, 'sign': 'Sagittarius', 'degree': 10.117387080866791, 'retrograde': False, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Jupiter': {'absolute_degree': 95.12631976638156, 'sign': 'Cancer', 'degree': 5.126319766381556, 'retr...', ...}}}
2025-06-25 16:33:22,138 - chart.celery_utils - INFO - Sync execution result: 1ee85efb-6dc7-45f1-a525-249479102e45
2025-06-25 16:33:22,139 - chart.celery_utils - INFO - Result successful: True
2025-06-25 16:33:22,139 - chart.celery_utils - INFO - Creating sync task status record for ephemeris_test...
2025-06-25 16:33:22,144 - chart.celery_utils - ERROR - Synchronous execution failed for ephemeris_test task: NOT NULL constraint failed: chart_task_status.traceback
2025-06-25 16:33:22,145 - chart.celery_utils - ERROR - Sync exception type: <class 'django.db.utils.IntegrityError'>
2025-06-25 16:33:22,228 - chart.celery_utils - ERROR - Sync traceback: Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\sqlite3\base.py", line 360, in execute
    return super().execute(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: chart_task_status.traceback

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\chart\celery_utils.py", line 158, in create_task_with_fallback
    task_status = TaskStatus.objects.create(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 902, in save
    self.save_base(
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\sql\compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\sqlite3\base.py", line 360, in execute
    return super().execute(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: NOT NULL constraint failed: chart_task_status.traceback

2025-06-25 16:33:22,238 - chart.celery_utils - INFO - Creating error task status record for ephemeris_test...
2025-06-25 16:33:22,244 - chart.celery_utils - INFO - Error task status record created: 1
2025-06-25 16:33:22,244 - chart.celery_utils - INFO - Returning sync error result: {'success': False, ...}
2025-06-25 16:33:22,245 - __main__ - INFO - Task result: {'success': False, 'task_id': '437f49f8-1008-4939-802a-34537b6c75ad', 'status': 'FAILURE', 'message': 'Synchronous execution failed for ephemeris_test task', 'celery_available': False, 'error': 'Sync: NOT NULL constraint failed: chart_task_status.traceback', 'task_status_id': 1}
2025-06-25 16:33:22,249 - __main__ - INFO - === TESTING CHART GENERATION ===
2025-06-25 16:33:22,250 - __main__ - INFO - Chart generation parameters: {'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus', 'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'location': 'Test Location'}
2025-06-25 16:33:22,250 - chart.celery_utils - INFO - === create_task_with_fallback START for chart_generation_test ===
2025-06-25 16:33:22,251 - chart.celery_utils - INFO - task_func: <@task: chart.tasks.generate_chart_task of default at 0x1c3370352d0>
2025-06-25 16:33:22,251 - chart.celery_utils - INFO - args: [{'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus', 'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'location': 'Test Location'}]
2025-06-25 16:33:22,252 - chart.celery_utils - INFO - kwargs: None
2025-06-25 16:33:22,252 - chart.celery_utils - INFO - user: None
2025-06-25 16:33:22,252 - chart.celery_utils - INFO - parameters: {'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus', 'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'location': 'Test Location'}
2025-06-25 16:33:22,253 - chart.celery_utils - INFO - Generated task_id: a005e849-c719-4394-bbc4-b7c20c249c3d
2025-06-25 16:33:22,253 - chart.celery_utils - INFO - Checking if Celery is available for chart_generation_test...
2025-06-25 16:33:28,319 - chart.celery_utils - WARNING - Celery broker not available: [WinError 10061] No connection could be made because the target machine actively refused it
2025-06-25 16:33:28,322 - chart.celery_utils - WARNING - Celery is not available for chart_generation_test, using fallback
2025-06-25 16:33:28,325 - chart.celery_utils - INFO - Executing chart_generation_test task synchronously as fallback: a005e849-c719-4394-bbc4-b7c20c249c3d
2025-06-25 16:33:28,328 - chart.celery_utils - INFO - Calling task_func.apply with args=[{'utc_date': '1990-01-01', 'utc_time': '16:00', 'latitude': 45.5, 'longitude': -64.3, 'zodiac_type': 'tropical', 'house_system': 'placidus', 'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'location': 'Test Location'}], kwargs={}
2025-06-25 16:33:28,332 - chart.tasks - INFO - Starting chart generation task 6854cbf9-2b2c-44ce-9f4f-139746d2ec46
2025-06-25 16:33:28,339 - chart.tasks - ERROR - Error generating Sun interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,342 - chart.tasks - ERROR - Error generating Moon interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,343 - chart.tasks - ERROR - Error generating Mercury interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,344 - chart.tasks - ERROR - Error generating Venus interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,345 - chart.tasks - ERROR - Error generating Mars interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,346 - chart.tasks - ERROR - Error generating Jupiter interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,347 - chart.tasks - ERROR - Error generating Saturn interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,347 - chart.tasks - ERROR - Error generating Uranus interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,347 - chart.tasks - ERROR - Error generating Neptune interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,348 - chart.tasks - ERROR - Error generating Pluto interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:28,348 - chart.tasks - ERROR - Error generating master interpretation: PromptManager.get_master_prompt() takes 1 positional argument but 2 were given
2025-06-25 16:33:28,350 - chart.tasks - INFO - Completed chart generation task 6854cbf9-2b2c-44ce-9f4f-139746d2ec46
2025-06-25 16:33:28,350 - celery.app.trace - INFO - Task chart.tasks.generate_chart_task[6854cbf9-2b2c-44ce-9f4f-139746d2ec46] succeeded in 0.016000000000076398s: {'success': True, 'chart_data': {'julian_day': 2447893.1666666665, 'positions': {'Sun': {...}, 'Moon': {...}, 'Mercury': {...}, 'Venus': {...}, 'Mars': {...}, 'Jupiter': {...}, 'Saturn': {...}, 'Uranus': {...}, 'Neptune': {...}, 'Pluto': {...}}, 'ascendant': {'absolute_degree': 13.058492568248969, 'sign': 'Aries', 'degree_in_sign': 13.058492568248969}, 'houses': (13.058492568248969, 52.30441855828194, 76.3367205586783, 96.19163345643585, 117.13842089049075, 145.36440540396342, 193.05849256824897, 232.30441855828195, 256.3367205586783, 276.19163345643585, 297.13842089049075, 325.3644054039634), 'house_signs': {0: 'Aries', 1: 'Taurus', 2: 'Gemini', 3: 'Cancer', 4: 'Cancer', 5: 'Leo', 6: 'Libra', 7: 'Scorpio', 8: 'Sagittarius', 9: 'Capricorn', 10: 'Capricorn', 11: 'Aquarius'}, 'birth_date': '1990-01-01', 'birth_time': '16:00', 'location': 'Test Location'}, 'planet_interpretations': {'Sun': 'Error generating Sun interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given', 'Moon...', ...}}
2025-06-25 16:33:28,351 - chart.celery_utils - INFO - Sync execution result: 6854cbf9-2b2c-44ce-9f4f-139746d2ec46
2025-06-25 16:33:28,352 - chart.celery_utils - INFO - Result successful: True
2025-06-25 16:33:28,352 - chart.celery_utils - INFO - Creating sync task status record for chart_generation_test...
2025-06-25 16:33:28,354 - chart.celery_utils - ERROR - Synchronous execution failed for chart_generation_test task: NOT NULL constraint failed: chart_task_status.traceback
2025-06-25 16:33:28,354 - chart.celery_utils - ERROR - Sync exception type: <class 'django.db.utils.IntegrityError'>
2025-06-25 16:33:28,356 - chart.celery_utils - ERROR - Sync traceback: Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\sqlite3\base.py", line 360, in execute
    return super().execute(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: chart_task_status.traceback

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\chart\celery_utils.py", line 158, in create_task_with_fallback
    task_status = TaskStatus.objects.create(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 902, in save
    self.save_base(
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\sql\compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\sqlite3\base.py", line 360, in execute
    return super().execute(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: NOT NULL constraint failed: chart_task_status.traceback

2025-06-25 16:33:28,364 - chart.celery_utils - INFO - Creating error task status record for chart_generation_test...
2025-06-25 16:33:28,368 - chart.celery_utils - INFO - Error task status record created: 2
2025-06-25 16:33:28,369 - chart.celery_utils - INFO - Returning sync error result: {'success': False, ...}
2025-06-25 16:33:28,370 - __main__ - INFO - Chart generation result: {'success': False, 'task_id': 'a005e849-c719-4394-bbc4-b7c20c249c3d', 'status': 'FAILURE', 'message': 'Synchronous execution failed for chart_generation_test task', 'celery_available': False, 'error': 'Sync: NOT NULL constraint failed: chart_task_status.traceback', 'task_status_id': 2}
2025-06-25 16:33:28,373 - __main__ - INFO - === TESTING INTERPRETATION GENERATION ===
2025-06-25 16:33:28,373 - __main__ - INFO - Interpretation parameters: {'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'interpretation_type': 'comprehensive'}
2025-06-25 16:33:28,373 - chart.celery_utils - INFO - === create_task_with_fallback START for interpretation_test ===
2025-06-25 16:33:28,374 - chart.celery_utils - INFO - task_func: <@task: chart.tasks.generate_interpretation_task of default at 0x1c3370352d0>
2025-06-25 16:33:28,374 - chart.celery_utils - INFO - args: [{'julian_day': 2447893.1666666665, 'positions': {'Sun': {'sign': 'Capricorn', 'degree': 10.5}, 'Moon': {'sign': 'Aries', 'degree': 15.2}}, 'ascendant': {'sign': 'Aries', 'degree': 13.1}, 'houses': [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330], 'house_signs': ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces']}, {'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'interpretation_type': 'comprehensive'}]
2025-06-25 16:33:28,375 - chart.celery_utils - INFO - kwargs: None
2025-06-25 16:33:28,376 - chart.celery_utils - INFO - user: None
2025-06-25 16:33:28,376 - chart.celery_utils - INFO - parameters: {'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'interpretation_type': 'comprehensive'}
2025-06-25 16:33:28,376 - chart.celery_utils - INFO - Generated task_id: 977a0ef2-b107-4b2e-83f4-9bf93a9f71e5
2025-06-25 16:33:28,377 - chart.celery_utils - INFO - Checking if Celery is available for interpretation_test...
2025-06-25 16:33:34,478 - chart.celery_utils - WARNING - Celery broker not available: [WinError 10061] No connection could be made because the target machine actively refused it
2025-06-25 16:33:34,480 - chart.celery_utils - WARNING - Celery is not available for interpretation_test, using fallback
2025-06-25 16:33:34,482 - chart.celery_utils - INFO - Executing interpretation_test task synchronously as fallback: 977a0ef2-b107-4b2e-83f4-9bf93a9f71e5
2025-06-25 16:33:34,483 - chart.celery_utils - INFO - Calling task_func.apply with args=[{'julian_day': 2447893.1666666665, 'positions': {'Sun': {'sign': 'Capricorn', 'degree': 10.5}, 'Moon': {'sign': 'Aries', 'degree': 15.2}}, 'ascendant': {'sign': 'Aries', 'degree': 13.1}, 'houses': [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330], 'house_signs': ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces']}, {'model_name': 'gpt-4', 'temperature': 0.7, 'max_tokens': 1000, 'interpretation_type': 'comprehensive'}], kwargs={}
2025-06-25 16:33:34,487 - chart.tasks - INFO - Starting interpretation generation task 9f035bac-5089-444c-9290-4ed681d4a88b
2025-06-25 16:33:34,489 - chart.tasks - ERROR - Error generating Sun interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:34,490 - chart.tasks - ERROR - Error generating Moon interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given
2025-06-25 16:33:34,492 - chart.tasks - ERROR - Error generating master interpretation: PromptManager.get_master_prompt() takes 1 positional argument but 2 were given
2025-06-25 16:33:34,495 - chart.tasks - INFO - Completed interpretation generation task 9f035bac-5089-444c-9290-4ed681d4a88b
2025-06-25 16:33:34,497 - celery.app.trace - INFO - Task chart.tasks.generate_interpretation_task[9f035bac-5089-444c-9290-4ed681d4a88b] succeeded in 0.01499999999987267s: {'success': True, 'planet_interpretations': {'Sun': 'Error generating Sun interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given', 'Moon': 'Error generating Moon interpretation: PromptManager.get_planet_prompt() takes 2 positional arguments but 3 were given'}, 'master_interpretation': 'Error generating master interpretation: PromptManager.get_master_prompt() takes 1 positional argument but 2 were given', 'task_id': '9f035bac-5089-444c-9290-4ed681d4a88b', 'completed_at': '2025-06-25T19:33:34.494637+00:00'}
2025-06-25 16:33:34,499 - chart.celery_utils - INFO - Sync execution result: 9f035bac-5089-444c-9290-4ed681d4a88b
2025-06-25 16:33:34,500 - chart.celery_utils - INFO - Result successful: True
2025-06-25 16:33:34,502 - chart.celery_utils - INFO - Creating sync task status record for interpretation_test...
2025-06-25 16:33:34,504 - chart.celery_utils - ERROR - Synchronous execution failed for interpretation_test task: NOT NULL constraint failed: chart_task_status.traceback
2025-06-25 16:33:34,506 - chart.celery_utils - ERROR - Sync exception type: <class 'django.db.utils.IntegrityError'>
2025-06-25 16:33:34,512 - chart.celery_utils - ERROR - Sync traceback: Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\sqlite3\base.py", line 360, in execute
    return super().execute(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: chart_task_status.traceback

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\chart\celery_utils.py", line 158, in create_task_with_fallback
    task_status = TaskStatus.objects.create(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\query.py", line 663, in create
    obj.save(force_insert=True, using=self.db)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 902, in save
    self.save_base(
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1008, in save_base
    updated = self._save_table(
              ^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1169, in _save_table
    results = self._do_insert(
              ^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\base.py", line 1210, in _do_insert
    return manager._insert(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\query.py", line 1868, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\models\sql\compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 122, in execute
    return super().execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\db\backends\sqlite3\base.py", line 360, in execute
    return super().execute(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
django.db.utils.IntegrityError: NOT NULL constraint failed: chart_task_status.traceback

2025-06-25 16:33:34,523 - chart.celery_utils - INFO - Creating error task status record for interpretation_test...
2025-06-25 16:33:34,529 - chart.celery_utils - INFO - Error task status record created: 3
2025-06-25 16:33:34,530 - chart.celery_utils - INFO - Returning sync error result: {'success': False, ...}
2025-06-25 16:33:34,531 - __main__ - INFO - Interpretation result: {'success': False, 'task_id': '977a0ef2-b107-4b2e-83f4-9bf93a9f71e5', 'status': 'FAILURE', 'message': 'Synchronous execution failed for interpretation_test task', 'celery_available': False, 'error': 'Sync: NOT NULL constraint failed: chart_task_status.traceback', 'task_status_id': 3}
2025-06-25 16:33:34,533 - __main__ - INFO - === TESTING DIRECT TASK EXECUTION ===
2025-06-25 16:33:34,534 - __main__ - INFO - Testing direct task execution...
2025-06-25 16:33:34,534 - chart.tasks - INFO - Starting ephemeris calculation task 419070d8-4d95-4fd8-800a-bdb8c346fc88
2025-06-25 16:33:34,535 - chart.tasks - INFO - Completed ephemeris calculation task 419070d8-4d95-4fd8-800a-bdb8c346fc88
2025-06-25 16:33:34,536 - celery.app.trace - INFO - Task chart.tasks.calculate_ephemeris_task[419070d8-4d95-4fd8-800a-bdb8c346fc88] succeeded in 0.0s: {'success': True, 'julian_day': 2447893.1666666665, 'positions': {'Sun': {'absolute_degree': 280.9841671564369, 'sign': 'Capricorn', 'degree': 10.98416715643691, 'retrograde': False, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Moon': {'absolute_degree': 335.51547225365795, 'sign': 'Pisces', 'degree': 5.515472253657947, 'retrograde': False, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Mercury': {'absolute_degree': 295.6209564847932, 'sign': 'Capricorn', 'degree': 25.620956484793226, 'retrograde': True, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Venus': {'absolute_degree': 306.19953435684306, 'sign': 'Aquarius', 'degree': 6.19953435684306, 'retrograde': True, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Mars': {'absolute_degree': 250.1173870808668, 'sign': 'Sagittarius', 'degree': 10.117387080866791, 'retrograde': False, 'house': 1, 'aspects': [...], 'dignity': 'Neutral'}, 'Jupiter': {'absolute_degree': 95.12631976638156, 'sign': 'Cancer', 'degree': 5.126319766381556, 'retr...', ...}}}
2025-06-25 16:33:34,538 - __main__ - INFO - Direct task result: 419070d8-4d95-4fd8-800a-bdb8c346fc88
2025-06-25 16:33:34,538 - __main__ - INFO - Task successful: True
2025-06-25 16:33:34,540 - __main__ - INFO - Task result: {'success': True, 'julian_day': 2447893.1666666665, 'positions': {'Sun': {'absolute_degree': 280.9841671564369, 'sign': 'Capricorn', 'degree': 10.98416715643691, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Moon', 'type': 'Sextile', 'orb': 5.468694902778964}, {'planet': 'Jupiter', 'type': 'Opposition', 'orb': 5.857847390055355}, {'planet': 'Saturn', 'type': 'Conjunction', 'orb': 4.693068114191988}, {'planet': 'Uranus', 'type': 'Conjunction', 'orb': 5.188691673121355}, {'planet': 'Neptune', 'type': 'Conjunction', 'orb': 1.0602706072894534}], 'dignity': 'Neutral'}, 'Moon': {'absolute_degree': 335.51547225365795, 'sign': 'Pisces', 'degree': 5.515472253657947, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Sun', 'type': 'Sextile', 'orb': 5.468694902778964}, {'planet': 'Mars', 'type': 'Square', 'orb': 4.601914827208844}, {'planet': 'Jupiter', 'type': 'Trine', 'orb': 0.38915248727639096}, {'planet': 'Uranus', 'type': 'Sextile', 'orb': 0.28000322965760915}], 'dignity': 'Neutral'}, 'Mercury': {'absolute_degree': 295.6209564847932, 'sign': 'Capricorn', 'degree': 25.620956484793226, 'retrograde': True, 'house': 1, 'aspects': [{'planet': 'Saturn', 'type': 'Conjunction', 'orb': 9.943721214164327}], 'dignity': 'Neutral'}, 'Venus': {'absolute_degree': 306.19953435684306, 'sign': 'Aquarius', 'degree': 6.19953435684306, 'retrograde': True, 'house': 1, 'aspects': [{'planet': 'Mars', 'type': 'Sextile', 'orb': 3.9178527240237315}, {'planet': 'Jupiter', 'type': 'Quincunx', 'orb': 1.0732145904615038}], 'dignity': 'Neutral'}, 'Mars': {'absolute_degree': 250.1173870808668, 'sign': 'Sagittarius', 'degree': 10.117387080866791, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Moon', 'type': 'Square', 'orb': 4.601914827208844}, {'planet': 'Venus', 'type': 'Sextile', 'orb': 3.9178527240237315}], 'dignity': 'Neutral'}, 'Jupiter': {'absolute_degree': 95.12631976638156, 'sign': 'Cancer', 'degree': 5.126319766381556, 'retrograde': True, 'house': 1, 'aspects': [{'planet': 'Sun', 'type': 'Opposition', 'orb': 5.857847390055355}, {'planet': 'Moon', 'type': 'Trine', 'orb': 0.38915248727639096}, {'planet': 'Venus', 'type': 'Quincunx', 'orb': 1.0732145904615038}, {'planet': 'Uranus', 'type': 'Opposition', 'orb': 0.6691557169340001}, {'planet': 'Neptune', 'type': 'Opposition', 'orb': 6.918117997344808}], 'dignity': 'Exaltation'}, 'Saturn': {'absolute_degree': 285.6772352706289, 'sign': 'Capricorn', 'degree': 15.677235270628898, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Sun', 'type': 'Conjunction', 'orb': 4.693068114191988}, {'planet': 'Mercury', 'type': 'Conjunction', 'orb': 9.943721214164327}, {'planet': 'Uranus', 'type': 'Conjunction', 'orb': 9.881759787313342}, {'planet': 'Neptune', 'type': 'Conjunction', 'orb': 3.6327975069025342}, {'planet': 'Pluto', 'type': 'Sextile', 'orb': 1.4204782768466941}], 'dignity': 'Ruler'}, 'Uranus': {'absolute_degree': 275.79547548331556, 'sign': 'Capricorn', 'degree': 5.795475483315556, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Sun', 'type': 'Conjunction', 'orb': 5.188691673121355}, {'planet': 'Moon', 'type': 'Sextile', 'orb': 0.28000322965760915}, {'planet': 'Jupiter', 'type': 'Opposition', 'orb': 0.6691557169340001}, {'planet': 'Saturn', 'type': 'Conjunction', 'orb': 9.881759787313342}, {'planet': 'Neptune', 'type': 'Conjunction', 'orb': 6.248962280410808}], 'dignity': 'Neutral'}, 'Neptune': {'absolute_degree': 282.04443776372636, 'sign': 'Capricorn', 'degree': 12.044437763726364, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Sun', 'type': 'Conjunction', 'orb': 1.0602706072894534}, {'planet': 'Jupiter', 'type': 'Opposition', 'orb': 6.918117997344808}, {'planet': 'Saturn', 'type': 'Conjunction', 'orb': 3.6327975069025342}, {'planet': 'Uranus', 'type': 'Conjunction', 'orb': 6.248962280410808}, {'planet': 'Pluto', 'type': 'Sextile', 'orb': 5.053275783749228}], 'dignity': 'Fall'}, 'Pluto': {'absolute_degree': 227.0977135474756, 'sign': 'Scorpio', 'degree': 17.097713547475593, 'retrograde': False, 'house': 1, 'aspects': [{'planet': 'Saturn', 'type': 'Sextile', 'orb': 1.4204782768466941}, {'planet': 'Neptune', 'type': 'Sextile', 'orb': 5.053275783749228}], 'dignity': 'Ruler'}}, 'ascendant': {'absolute_degree': 13.058492568248969, 'sign': 'Aries', 'degree_in_sign': 13.058492568248969}, 'houses': (13.058492568248969, 52.30441855828194, 76.3367205586783, 96.19163345643585, 117.13842089049075, 145.36440540396342, 193.05849256824897, 232.30441855828195, 256.3367205586783, 276.19163345643585, 297.13842089049075, 325.3644054039634), 'house_signs': {0: 'Aries', 1: 'Taurus', 2: 'Gemini', 3: 'Cancer', 4: 'Cancer', 5: 'Leo', 6: 'Libra', 7: 'Scorpio', 8: 'Sagittarius', 9: 'Capricorn', 10: 'Capricorn', 11: 'Aquarius'}, 'task_id': '419070d8-4d95-4fd8-800a-bdb8c346fc88', 'completed_at': '2025-06-25T19:33:34.535274+00:00'}
2025-06-25 16:33:34,543 - __main__ - INFO - === TEST SUMMARY ===
2025-06-25 16:33:34,552 - __main__ - INFO - Overall: 1/5 tests passed
2025-06-25 16:33:34,552 - __main__ - INFO - Detailed logs saved to: celery_test_output_20250625_163309.txt
