üöÄ Starting Phase 2 Monitoring & Observability Tests
============================================================
‚úÖ HealthCheckResult Creation: PASS
   Details: {'response_time': 0.5}
‚úÖ Database Health Check: PASS
   Details: {'status': 'healthy', 'response_time': 0.0}
‚úÖ Redis Health Check: PASS
   Details: {'status': 'healthy', 'response_time': 0.023317337036132812}
‚úÖ Comprehensive Health Check: PASS
   Details: {'overall_status': 'unhealthy', 'total_checks': 8}
‚úÖ Performance Monitor: PASS
   Details: {'cache_hits': 1, 'cache_misses': 1}
‚úÖ get_system_health Function: PASS
   Details: {'overall_status': 'unhealthy'}
‚úÖ get_quick_health_status Function: PASS
   Details: {'status': 'healthy'}
‚úÖ Performance Functions: PASS
   Details: {'period_minutes': 60}
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Subject: Error 500 on /api/v1/system/health/
From: noreply@outerskies.com
To: admin@example.com
Date: Wed, 25 Jun 2025 20:55:15 -0000
Message-ID: <175088491559.3908.17528526493890431180@DESKTOP-SUFT37C.home>

{
  "status_code": 500,
  "path": "/api/v1/system/health/",
  "method": "GET",
  "client_ip": "127.0.0.1",
  "user_agent": null,
  "timestamp": 1750884915.591664
}
-------------------------------------------------------------------------------
‚ùå API Endpoints: FAIL
   Error: Object of type WindowsPath is not JSON serializable
Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\test_phase2_monitoring.py", line 242, in test_api_endpoints
    response = self.client.get('/api/v1/system/health/')
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\test\client.py", line 1124, in get
    response = super().get(
               ^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\test\client.py", line 475, in get
    return self.generic(
           ^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\test\client.py", line 671, in generic
    return self.request(**r)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\test\client.py", line 1087, in request
    self.check_exception(response)
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\test\client.py", line 802, in check_exception
    raise exc_value
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\core\handlers\base.py", line 220, in _get_response
    response = response.render()
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\django\template\response.py", line 114, in render
    self.content = self.rendered_content
                   ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\rest_framework\response.py", line 74, in rendered_content
    ret = renderer.render(self.data, accepted_media_type, context)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\rest_framework\renderers.py", line 100, in render
    ret = json.dumps(
          ^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\rest_framework\utils\json.py", line 25, in dumps
    return json.dumps(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\AppData\Local\Programs\Python\Python311\Lib\json\__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "C:\Users\trueb\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           ^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\outer-skies\venv311\Lib\site-packages\rest_framework\utils\encoders.py", line 67, in default
    return super().default(obj)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trueb\AppData\Local\Programs\Python\Python311\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type WindowsPath is not JSON serializable

‚ùå Admin Dashboard Access: FAIL
   Error: Expected 403, got 302, content: b''
Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\test_phase2_monitoring.py", line 275, in test_admin_dashboard_access
    assert response.status_code == 403, f"Expected 403, got {response.status_code}, content: {response.content}"
AssertionError: Expected 403, got 302, content: b''

‚ùå Middleware Integration: FAIL
   Error: Middleware not found in settings: ['django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'django_prometheus.middleware.PrometheusBeforeMiddleware', 'django_prometheus.middleware.PrometheusAfterMiddleware', 'chart.middleware.security.EnhancedSecurityMiddleware', 'chart.middleware.rate_limit.RateLimitMiddleware', 'chart.middleware.auth.APIAuthMiddleware', 'chart.middleware.validation.DataValidationMiddleware', 'chart.middleware.password.PasswordSecurityMiddleware', 'chart.middleware.file_upload.FileUploadSecurityMiddleware', 'chart.middleware.error_handling.ErrorHandlingMiddleware', 'chart.middleware.session.SessionSecurityMiddleware', 'chart.middleware.api_version.APIVersionMiddleware', 'chart.middleware.request_signing.RequestSigningMiddleware', 'chart.middleware.encryption.EncryptionMiddleware']
Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\test_phase2_monitoring.py", line 298, in test_middleware_integration
    assert 'monitoring.performance_monitor.PerformanceMonitoringMiddleware' in middleware_classes, f"Middleware not found in settings: {middleware_classes}"
AssertionError: Middleware not found in settings: ['django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'django_prometheus.middleware.PrometheusBeforeMiddleware', 'django_prometheus.middleware.PrometheusAfterMiddleware', 'chart.middleware.security.EnhancedSecurityMiddleware', 'chart.middleware.rate_limit.RateLimitMiddleware', 'chart.middleware.auth.APIAuthMiddleware', 'chart.middleware.validation.DataValidationMiddleware', 'chart.middleware.password.PasswordSecurityMiddleware', 'chart.middleware.file_upload.FileUploadSecurityMiddleware', 'chart.middleware.error_handling.ErrorHandlingMiddleware', 'chart.middleware.session.SessionSecurityMiddleware', 'chart.middleware.api_version.APIVersionMiddleware', 'chart.middleware.request_signing.RequestSigningMiddleware', 'chart.middleware.encryption.EncryptionMiddleware']

‚ùå Logging and Alerting: FAIL
   Error: Expected warning/error in logs. Log output: 
Traceback (most recent call last):
  File "C:\Users\trueb\outer-skies\test_phase2_monitoring.py", line 317, in test_logging_and_alerting
    assert 'warning' in log_output.lower() or 'error' in log_output.lower(), f"Expected warning/error in logs. Log output: {log_output}"
AssertionError: Expected warning/error in logs. Log output: 

‚úÖ Cache Integration: PASS
   Details: {'set_operation': True, 'get_operation': True, 'delete_operation': True}
‚úÖ Database Integration: PASS
   Details: {'query_executed': True, 'result_count': 55}
‚úÖ Error Handling - Invalid Metric Value: PASS

============================================================
üìä PHASE 2 TEST RESULTS SUMMARY
============================================================
Total Tests: 15
Passed: 11 ‚úÖ
Failed: 4 ‚ùå
Success Rate: 73.3%
Test Duration: 13.38 seconds

‚ùå FAILED TESTS:
  - API Endpoints: Object of type WindowsPath is not JSON serializable
  - Admin Dashboard Access: Expected 403, got 302, content: b''
  - Middleware Integration: Middleware not found in settings: ['django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'django_prometheus.middleware.PrometheusBeforeMiddleware', 'django_prometheus.middleware.PrometheusAfterMiddleware', 'chart.middleware.security.EnhancedSecurityMiddleware', 'chart.middleware.rate_limit.RateLimitMiddleware', 'chart.middleware.auth.APIAuthMiddleware', 'chart.middleware.validation.DataValidationMiddleware', 'chart.middleware.password.PasswordSecurityMiddleware', 'chart.middleware.file_upload.FileUploadSecurityMiddleware', 'chart.middleware.error_handling.ErrorHandlingMiddleware', 'chart.middleware.session.SessionSecurityMiddleware', 'chart.middleware.api_version.APIVersionMiddleware', 'chart.middleware.request_signing.RequestSigningMiddleware', 'chart.middleware.encryption.EncryptionMiddleware']
  - Logging and Alerting: Expected warning/error in logs. Log output: 

============================================================
DETAILED TEST RESULTS
============================================================

Test: HealthCheckResult Creation
Status: PASS
Timestamp: 2025-06-25T20:55:04.754902+00:00
Details: {
  "response_time": 0.5
}
----------------------------------------

Test: Database Health Check
Status: PASS
Timestamp: 2025-06-25T20:55:04.754902+00:00
Details: {
  "status": "healthy",
  "response_time": 0.0
}
----------------------------------------

Test: Redis Health Check
Status: PASS
Timestamp: 2025-06-25T20:55:04.778219+00:00
Details: {
  "status": "healthy",
  "response_time": 0.023317337036132812
}
----------------------------------------

Test: Comprehensive Health Check
Status: PASS
Timestamp: 2025-06-25T20:55:09.274269+00:00
Details: {
  "overall_status": "unhealthy",
  "total_checks": 8
}
----------------------------------------

Test: Performance Monitor
Status: PASS
Timestamp: 2025-06-25T20:55:09.275240+00:00
Details: {
  "cache_hits": 1,
  "cache_misses": 1
}
----------------------------------------

Test: get_system_health Function
Status: PASS
Timestamp: 2025-06-25T20:55:13.040566+00:00
Details: {
  "overall_status": "unhealthy"
}
----------------------------------------

Test: get_quick_health_status Function
Status: PASS
Timestamp: 2025-06-25T20:55:13.041530+00:00
Details: {
  "status": "healthy"
}
----------------------------------------

Test: Performance Functions
Status: PASS
Timestamp: 2025-06-25T20:55:13.041530+00:00
Details: {
  "period_minutes": 60
}
----------------------------------------

Test: API Endpoints
Status: FAIL
Timestamp: 2025-06-25T20:55:15.614020+00:00
Error: Object of type WindowsPath is not JSON serializable
----------------------------------------

Test: Admin Dashboard Access
Status: FAIL
Timestamp: 2025-06-25T20:55:15.910822+00:00
Error: Expected 403, got 302, content: b''
----------------------------------------

Test: Middleware Integration
Status: FAIL
Timestamp: 2025-06-25T20:55:15.941971+00:00
Error: Middleware not found in settings: ['django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'django_prometheus.middleware.PrometheusBeforeMiddleware', 'django_prometheus.middleware.PrometheusAfterMiddleware', 'chart.middleware.security.EnhancedSecurityMiddleware', 'chart.middleware.rate_limit.RateLimitMiddleware', 'chart.middleware.auth.APIAuthMiddleware', 'chart.middleware.validation.DataValidationMiddleware', 'chart.middleware.password.PasswordSecurityMiddleware', 'chart.middleware.file_upload.FileUploadSecurityMiddleware', 'chart.middleware.error_handling.ErrorHandlingMiddleware', 'chart.middleware.session.SessionSecurityMiddleware', 'chart.middleware.api_version.APIVersionMiddleware', 'chart.middleware.request_signing.RequestSigningMiddleware', 'chart.middleware.encryption.EncryptionMiddleware']
----------------------------------------

Test: Logging and Alerting
Status: FAIL
Timestamp: 2025-06-25T20:55:18.126850+00:00
Error: Expected warning/error in logs. Log output: 
----------------------------------------

Test: Cache Integration
Status: PASS
Timestamp: 2025-06-25T20:55:18.128851+00:00
Details: {
  "set_operation": true,
  "get_operation": true,
  "delete_operation": true
}
----------------------------------------

Test: Database Integration
Status: PASS
Timestamp: 2025-06-25T20:55:18.128851+00:00
Details: {
  "query_executed": true,
  "result_count": 55
}
----------------------------------------

Test: Error Handling - Invalid Metric Value
Status: PASS
Timestamp: 2025-06-25T20:55:18.130060+00:00
----------------------------------------

SUMMARY:
Total Tests: 15
Passed: 11
Failed: 4
Success Rate: 73.3%
Duration: 13.38 seconds
